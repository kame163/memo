<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>メモアプリ</title>
<link rel="manifest" href="/manifest.json">
<style>
body { font-family: sans-serif; padding:20px; }
input { padding:5px; }
button { margin-left:5px; }
li { margin:8px 0; }
</style>
</head>
<body>

<h1>メモアプリ</h1>

<input type="text" id="memoInput" placeholder="メモを入力">
<button id="addBtn">追加</button>

<ul id="memoList"></ul>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabaseUrl = "https://hivxamfcuntyviilmkdl.supabase.co";
const supabaseKey = "sb_publishable_WvgO-imEBepPVdpe0DxRuA_OnP7PUgp";
const db = createClient(supabaseUrl, supabaseKey);

async function loadMemos() {
  const { data, error } = await db
    .from("memos")
    .select("*")
    .order("id", { ascending: true });

  console.log("SELECT RESULT:", data, error);

  if (error) {
    alert("SELECTエラー: " + error.message);
    return;
  }
    

  const list = document.getElementById("memoList");
  list.innerHTML = "";

  data.forEach((item) => {
    const li = document.createElement("li");
    li.textContent = item.content + " ";

    const btn = document.createElement("button");
    btn.textContent = "削除";
    btn.onclick = () => deleteMemo(item.id);

    li.appendChild(btn);
    list.appendChild(li);
  });
}

async function addMemo() {
  const input = document.getElementById("memoInput");
  if (input.value.trim() === "") return;

  const { data, error } = await db
    .from("memos")
    .insert([{ content: input.value }]);

  console.log("INSERT RESULT:", data, error);

  if (error) {
    alert("エラー: " + error.message);
    return;
  }

  input.value = "";
  loadMemos();
}

async function deleteMemo(id) {
  await db
    .from("memos")
    .delete()
    .eq("id", id);

  loadMemos();
}

window.onload = loadMemos;
</script>

</body>
</html>